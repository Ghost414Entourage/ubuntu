https://github.com/xdp-project/xdp-tools/tree/main/xdp-filter

https://phb-crystal-ball.org/learn-to-list-loaded-kernel-modules-on-your-system/

https://openwrt.org/docs/guide-developer/toolchain/install-buildsystem

https://manpages.ubuntu.com/manpages/plucky/man8/xdp-filter.8.html

https://github.com/xdp-project/xdp-tutorial/blob/main/setup_dependencies.org

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

sudo apt install clang llvm libelf-dev libpcap-dev build-essential libc6-dev-i386 m4

sudo apt install linux-perf

sudo apt install linux-headers-$(uname -r)

sudo apt install linux-tools-common linux-tools-generic
sudo apt install tcpdump

sudo apt install bpftool
sudo apt install tcpdump



sudo apt update
sudo apt install -y \
  iproute2 \
  iputils-ping \
  ethtool \
  clang \
  llvm \
  libelf-dev \
  libbpf-dev \
  gcc \
  make \
  bpftool \
  linux-headers-$(uname -r)



sudo apt install -y libbpf-dev


sudo apt install -y linux-tools-common linux-tools-$(uname -r)


sudo apt install -y linux-lowlatency-tools-common linux-tools-$(uname -r)


sudo apt install -y linux-xilinx-tools-common linux-tools-$(uname -r)


which bpftool
bpftool version
bpftool feature probe kernel

apt install net-tools

apt install xdp-tools

apt install xdp*



////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


xdp-filter status


bpftool net


ifconfig 

xdp-filter load enp0s1

xdp-filter unload enp0s1


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

xdp-filter load --mode skb


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

apt update
apt install -y \
  git clang llvm libelf-dev libpcap-dev \
  build-essential pkg-config iproute2 \
  linux-headers-$(uname -r)

cd /usr/src
git clone https://github.com/xdp-project/xdp-tools.git
cd xdp-tools

apt install -y m4


./configure

make 

make install

export PATH=/usr/local/sbin:$PATH
which xdp-filter


which xdp-filter
/usr/local/sbin/xdp-filter

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


lsmod | awk '{print $1}' | tail -n +2 > /tmp/loaded_modules.txt && \
find /lib/modules/$(uname -r) -type f \( -name '*bpf*' -o -name '*xdp*' -o -name '*tc*' \) \
| while read -r m; do
    mod=$(basename "$m" | sed 's/\.ko.*//')
    if grep -qx "$mod" /tmp/loaded_modules.txt; then
        echo "LOADED     $m"
    else
        echo "NOT LOADED $m"
    fi
done


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


lsmod | awk '{print $1}' | tail -n +2 > /tmp/loaded_modules.txt && \
find /lib/modules/$(uname -r) -type f \( -name '*bpf*' -o -name '*xdp*' -o -name '*tc*' \) \
| while read -r m; do
    mod=$(basename "$m" | sed 's/\.ko.*//')
    if ! grep -qx "$mod" /tmp/loaded_modules.txt; then
        echo "Loading $mod"
        modprobe "$mod"
    fi
done


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
xdp-filter unload wlp3s0

xdp-filter load --mode skb wlp3s0 -f ipv4,tcp,udp

xdp-filter port -m src,dst -p tcp,udp 443

xdp-filter status

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

for i in {1..1000}; do
  xdp-filter port -m src,dst -p tcp,udp $i
done

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

xdp-filter port -m src,dst -p tcp,udp 1-21
xdp-filter port -m src,dst -p tcp,udp 23-52
xdp-filter port -m src,dst -p tcp,udp 54-66
xdp-filter port -m src,dst -p tcp,udp 69-79
xdp-filter port -m src,dst -p tcp,udp 81-442
xdp-filter port -m src,dst -p tcp,udp 444-1000
xdp-filter port -m src,dst -p tcp,udp 1001-10000
xdp-filter port -m src,dst -p tcp,udp 10001-20000
xdp-filter port -m src,dst -p tcp,udp 20001-30000
xdp-filter port -m src,dst -p tcp,udp 30001-40000
xdp-filter port -m src,dst -p tcp,udp 40001-50000
xdp-filter port -m src,dst -p tcp,udp 50001-60000
xdp-filter port -m src,dst -p tcp,udp 60001-65535

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

sudo xdp-filter load wlp3s0 -f ipv4 -p deny -m skb

sudo xdp-filter load wlp3s0 -f ipv4,tcp,udp -p deny -m skb


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



