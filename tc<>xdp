https://github.com/xdp-project/xdp-tools/tree/main/xdp-filter

https://phb-crystal-ball.org/learn-to-list-loaded-kernel-modules-on-your-system/

https://openwrt.org/docs/guide-developer/toolchain/install-buildsystem

https://manpages.ubuntu.com/manpages/plucky/man8/xdp-filter.8.html

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


sudo apt update
sudo apt install -y \
  iproute2 \
  iputils-ping \
  ethtool \
  clang \
  llvm \
  libelf-dev \
  libbpf-dev \
  gcc \
  make \
  bpftool \
  linux-headers-$(uname -r)



sudo apt install -y libbpf-dev


sudo apt install -y linux-tools-common linux-tools-$(uname -r)


sudo apt install -y linux-lowlatency-tools-common linux-tools-$(uname -r)


sudo apt install -y linux-xilinx-tools-common linux-tools-$(uname -r)


which bpftool
bpftool version
bpftool feature probe kernel

apt install net-tools

apt install xdp-tools

apt install xdp*



////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


xdp-filter status


bpftool net


ifconfig 

xdp-filter load enp0s1

xdp-filter unload enp0s1


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

xdp-filter load --mode skb


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

apt update
apt install -y \
  git clang llvm libelf-dev libpcap-dev \
  build-essential pkg-config iproute2 \
  linux-headers-$(uname -r)

cd /usr/src
git clone https://github.com/xdp-project/xdp-tools.git
cd xdp-tools

apt install -y m4


./configure

make 

make install

export PATH=/usr/local/sbin:$PATH
which xdp-filter


which xdp-filter
/usr/local/sbin/xdp-filter

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


lsmod | awk '{print $1}' | tail -n +2 > /tmp/loaded_modules.txt && \
find /lib/modules/$(uname -r) -type f \( -name '*bpf*' -o -name '*xdp*' -o -name '*tc*' \) \
| while read -r m; do
    mod=$(basename "$m" | sed 's/\.ko.*//')
    if grep -qx "$mod" /tmp/loaded_modules.txt; then
        echo "LOADED     $m"
    else
        echo "NOT LOADED $m"
    fi
done


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


lsmod | awk '{print $1}' | tail -n +2 > /tmp/loaded_modules.txt && \
find /lib/modules/$(uname -r) -type f \( -name '*bpf*' -o -name '*xdp*' -o -name '*tc*' \) \
| while read -r m; do
    mod=$(basename "$m" | sed 's/\.ko.*//')
    if ! grep -qx "$mod" /tmp/loaded_modules.txt; then
        echo "Loading $mod"
        modprobe "$mod"
    fi
done


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

xdp-filter load enp0s1 -f tcp,udp


for p in {1..21}; do xdp-filter port $p -m dst -p tcp,udp; done

for p in {1..21} {23..52} {54..66} {69..79} {81..442} {444..10000}; do xdp-filter port $p -m dst -p tcp,udp; done

xdp-filter status
xdp-filter unload enp0s1

xdp-filter port 443


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

xdp-filter load enp0s1 -f tcp,udp -p deny

xdp-filter port 443 -m dst -p tcp,udp

xdp-filter status

xdp-filter unload enp0s1

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


